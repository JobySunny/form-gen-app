import * as React from 'react';
import {InputProps as Props} from './Input.interface';
import {
  INPUT_TYPE_TEXT,
  INITIAL_SEARCH_TEXT,
} from '../../Select.constants';
import {getThrottle} from '../../Select.utils';

/**
 * Input
 *  HTML Input element; Fires onSearch with throttle;
 */
export function Input(props: Props): JSX.Element {
  const throttle = getThrottle('onSearch');

  const [search, setSearch] = React.useState(
    props.value ?? INITIAL_SEARCH_TEXT
  );

  const onChange: React.ChangeEventHandler<HTMLInputElement> = (e) => {
    setSearch(e.target.value);
  };

  React.useEffect(() => {
    if (!(search === props.value)) {
      throttle(() => {
        props.onSearch(search);
      });
    }
  }, [search]);

  return (
    <input
      tabIndex={-1}
      value={search}
      autoFocus={true}
      onChange={onChange}
      type={INPUT_TYPE_TEXT}
      data-testid={props.testId}
      className={props.className}
    />
  );
}
