import React from 'react';
import {FormRendererProps as Props} from './FormRenderer.interface';
import {FormContext} from './FormRenderer.utils';

import {FormCanvas} from './FormCanvas';
import {INPUT} from '../../Utils/constants';

import cn from './FormRenderer.module.scss';

/*
 * FormRenderer:
 *  - Component that render a generated form template to DOM
 *  - Manages opertions with input elements and values can be accessed once submitted
 */
export const FormRenderer = React.forwardRef((props: Props, ref: any) => {
  const formId = React.useId();

  const onSubmit: React.FormEventHandler<HTMLFormElement> = (e) => {
    e.preventDefault();
    const formData = new FormData(e.currentTarget);
    props.onSubmit(formData);
  };

  const {submitted = false} = props;

  return (
    <FormContext.Provider value={{submitted}}>
      <form className={props.className} id={formId} onSubmit={onSubmit}>
        <FormCanvas
          template={props.template}
          templateValues={props.templateValues}
        />
        <input className={cn.btn} type={INPUT.SUBMIT} ref={ref} />
      </form>
    </FormContext.Provider>
  );
});
