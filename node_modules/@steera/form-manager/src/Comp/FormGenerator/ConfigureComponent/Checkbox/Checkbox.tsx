import React from 'react';
import {CheckboxProps as Props} from './Checkbox.interface';
import {useAppDispatch} from '../../StoreProvider';
import {Action} from '../../Store';

import cn from './Checkbox.module.scss';
import {getThrottle} from '../../../../Utils/commonUtils';

export function Checkbox(props: Props) {
  const throttle = getThrottle('checkboxChange');
  const dispatch = useAppDispatch();
  const [checked, setChecked] = React.useState<boolean>();

  React.useEffect(() => {
    if (props.checked !== checked) {
      setChecked(props.checked);
    }
  }, [props.checked]);

  const onChange: React.ChangeEventHandler<HTMLInputElement> = (e) => {
    setChecked(e?.target.checked);
  };

  React.useEffect(() => {
    if (checked !== props.checked) {
      throttle(() => {
        dispatch(Action.updateOptionItem({name: props.name, checked}));
      });
    }
  }, [checked]);

  return (
    <input
      id={props.id}
      className={cn.cbox}
      type={props.type}
      name={props.name}
      disabled={props.disabled}
      value={props.value}
      required={props.required}
      checked={checked}
      onChange={onChange}
    />
  );
}
