import React from 'react';
import {SelectProps as Props} from './Select.interface';
import {useAppDispatch} from '../../StoreProvider';
import {Action} from '../../Store';
import {getThrottle} from '../../../../Utils/commonUtils';

import cn from './Select.module.scss';

export function Select(props: Props) {
  const throttle = getThrottle('onSelectChange');
  const dispatch = useAppDispatch();
  const [value, setValue] = React.useState(props.value);

  const onChange: React.ChangeEventHandler<HTMLSelectElement> = (e) => {
    setValue(e?.target.value);
  };

  React.useEffect(() => {
    if (value !== props.value) {
      throttle(() => {
        dispatch(Action.updateOptionItem({name: props.name, value}));
      });
    }
  }, [value]);

  const renderOption = (opt: {value: string; label: string}) => (
    <option key={opt.value} className={cn.opt} value={opt.value}>
      {opt.label}
    </option>
  );

  return (
    <select
      id={props.id}
      className={cn.sel}
      name={props.name}
      value={value}
      onChange={onChange}>
      {props.options.map(renderOption)}
    </select>
  );
}
