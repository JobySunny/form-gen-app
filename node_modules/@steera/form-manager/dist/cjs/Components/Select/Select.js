"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Select = void 0;
const jsx_runtime_1 = require("react/jsx-runtime");
const React = __importStar(require("react"));
const Wrap_1 = require("./Wrap");
const Icon_1 = require("./Icon");
const Content_1 = require("./Content");
const Options_1 = require("./Options");
const SelectTag_1 = require("./SelectTag");
const InputBlock_1 = require("./InputBlock");
const Select_constants_1 = require("./Select.constants");
const Select_utils_1 = require("./Select.utils");
const Select_module_scss_1 = __importDefault(require("./Select.module.scss"));
/**
 * Select
 *  Custom Select component for Async operations
 */
function Select(props) {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j;
    const [state, setState] = React.useState({
        focused: false,
        options: [],
        loading: false,
        showOptions: false,
    });
    const delay = (0, Select_utils_1.getThrottle)('onBlurDelay');
    const onSearch = (searchText) => __awaiter(this, void 0, void 0, function* () {
        setState((s) => (Object.assign(Object.assign({}, s), { loading: true, showOptions: true })));
        try {
            const options = yield props.onSearch(searchText);
            setState((s) => (Object.assign(Object.assign({}, s), { loading: false, options })));
        }
        catch (error) {
            setState((s) => (Object.assign(Object.assign({}, s), { loading: false, options: [] })));
        }
    });
    const onFocus = (target) => {
        setState((s) => (Object.assign(Object.assign({}, s), { focused: true })));
        (props === null || props === void 0 ? void 0 : props.onFocus) && props.onFocus(target);
    };
    const onBlur = (target) => {
        delay(() => {
            setState((s) => (Object.assign(Object.assign({}, s), { focused: false, showOptions: false })));
            (props === null || props === void 0 ? void 0 : props.onBlur) && props.onBlur(target);
        }, Select_constants_1.DELAY);
    };
    const onSelect = (option) => {
        props.onSelect({ name: props.name, value: option });
        delay(() => {
            setState((s) => (Object.assign(Object.assign({}, s), { showOptions: false })));
        }, Select_constants_1.DELAY);
    };
    const getClassName = (selector = '') => {
        return `${Select_module_scss_1.default[`sel${selector}`]} ${props.className}${selector}`;
    };
    return ((0, jsx_runtime_1.jsxs)(Wrap_1.Wrap, Object.assign({ testId: (_a = props.testId) !== null && _a !== void 0 ? _a : '', onFocus: onFocus, onBlur: onBlur, className: getClassName(''), disabled: (_b = props.disabled) !== null && _b !== void 0 ? _b : false }, { children: [(0, jsx_runtime_1.jsxs)(Content_1.Content, Object.assign({ className: getClassName('_main') }, { children: [(0, jsx_runtime_1.jsx)(SelectTag_1.SelectTag, { name: props.name, id: props.id, testId: (_c = props.testId) !== null && _c !== void 0 ? _c : '', options: state.options, value: (_d = props.value) === null || _d === void 0 ? void 0 : _d.value, disabled: props.disabled, required: props.required, className: getClassName('_main__tag') }), (0, jsx_runtime_1.jsx)(InputBlock_1.InputBlock, { focused: state.focused, value: (_e = props.value) === null || _e === void 0 ? void 0 : _e.label, onSearch: onSearch, testId: (_f = props.testId) !== null && _f !== void 0 ? _f : '', disabled: props.disabled, placeholder: (_g = props.placeholder) !== null && _g !== void 0 ? _g : '', className: getClassName('_main__input') }), (0, jsx_runtime_1.jsx)(Icon_1.Icon, { focus: state.focused, loading: state.loading, testId: (_h = props.testId) !== null && _h !== void 0 ? _h : '', className: getClassName('_main__iconBlock'), iconClassName: getClassName('_main__iconBlock_item') })] })), (0, jsx_runtime_1.jsx)(Options_1.Options, { show: state.showOptions, testId: (_j = props.testId) !== null && _j !== void 0 ? _j : '', className: getClassName('_options'), options: state.options, loading: state.loading, onSelect: onSelect, optionClass: getClassName('_options__item') })] })));
}
exports.Select = Select;
//# sourceMappingURL=Select.js.map